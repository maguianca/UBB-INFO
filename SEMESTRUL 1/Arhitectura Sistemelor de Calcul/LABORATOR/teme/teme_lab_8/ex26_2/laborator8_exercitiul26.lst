     1                                  
     2                                  bits 32
     3                                  global start        
     4                                  ;ex 26:Se da un nume de fisier (definit in segmentul de date). Sa se creeze un fisier cu numele dat, apoi sa se citeasca de la tastatura ;cuvinte pana cand se citeste de la tastatura caracterul '$'. Sa se scrie in f
     5                                  ; declararea functiilor externe folosite de program
     6                                  extern exit, fopen, fprintf, fclose, scanf
     7                                  import exit msvcrt.dll  
     8                                  import fopen msvcrt.dll  
     9                                  import fprintf msvcrt.dll
    10                                  import fclose msvcrt.dll
    11                                  import scanf msvcrt.dll
    12                                                            
    13                                  segment  data use32 class=data
    14 00000000 00                      	n db 0       ; in aceasta variabila se va stoca valoarea citita de la tastatura
    15 00000001 257300                  	format  db "%s", 0  ; %d <=> un numar decimal (baza 10)
    16 00000004 7700                        mod_acces db "w", 0
    17 00000006 6965736972652E7478-         nume_fisier db "iesire.txt", 0
    17 0000000F 7400               
    18 00000011 00000000                    descriptor_fisier dd 0
    19 00000015 <res 00000064>              text resb 100
    20 00000079 256300                      char db "%c",0
    21                                      
    22                                  segment  code use32 class=code
    23                                      start:
    24                                          ; Deschiderea fisierului
    25 00000000 68[04000000]                    push dword mod_acces
    26 00000005 68[06000000]                    push dword nume_fisier
    27 0000000A FF15[00000000]                  call [fopen]
    28 00000010 83C408                          add esp, 4 * 2
    29 00000013 83F800                          cmp eax, 0
    30 00000016 7469                            je final ; eroare la deschiderea fisierului
    31 00000018 A3[11000000]                    mov [descriptor_fisier], eax
    32                                  
    33                                       citire:
    34                                          ; vom apela scanf(format, n) => se va citi un numar in variabila n
    35                                          ; punem parametrii pe stiva de la dreapta la stanga
    36 0000001D 68[15000000]                    push  dword text       ; ! adresa lui n, nu valoarea
    37 00000022 68[01000000]                    push  dword format
    38 00000027 FF15[00000000]                  call  [scanf]       ; apelam functia scanf pentru citire
    39 0000002D 83C408                          add  esp, 4 * 2     ; eliberam parametrii de pe stiva; 4 = dimensiunea unui dword; 2 = nr de parametri
    40                                          
    41                                          ;convertim n la dword pentru a pune valoarea pe stiva 
    42 00000030 B800000000                      mov  eax,0
    43 00000035 A0[15000000]                    mov  al,byte[text]
    44 0000003A 3C24                            cmp al, '$'
    45 0000003C 7434                            je finalizare_scriere ; Daca am intalnit '$', iesim din bucla
    46 0000003E 3C41                            cmp al,'A'
    47 00000040 7CDB                            jl citire
    48 00000042 3C5A                            cmp al,'Z'
    49 00000044 7FD7                            jg citire
    50                                          
    51                                          ;afisam mesajul si valoarea lui n
    52 00000046 68[15000000]                    push dword text
    53 0000004B FF35[11000000]                  push dword [descriptor_fisier]
    54 00000051 FF15[00000000]                  call  [fprintf]
    55 00000057 83C408                          add  esp,4*2
    56                                          
    57 0000005A 6A20                            push dword ' '  ; ASCII pentru spa»õiu
    58 0000005C 68[79000000]                    push dword char
    59 00000061 FF35[11000000]                  push dword [descriptor_fisier]
    60 00000067 FF15[00000000]                  call [fprintf]
    61 0000006D 83C40C                          add esp, 4 * 3
    62                                          
    63                                          
    64 00000070 E2AB                          loop citire
    65                                          
    66                                        finalizare_scriere:
    67                                          ; Inchidem fisierul
    68 00000072 FF35[11000000]                  push dword [descriptor_fisier]
    69 00000078 FF15[00000000]                  call [fclose]
    70 0000007E 83C404                          add esp, 4
    71                                          ; exit(0)
    72                                         final:
    73 00000081 6A00                            push  dword 0     ; punem pe stiva parametrul pentru exit
    74 00000083 FF15[00000000]                  call  [exit]       ; apelam exit pentru a incheia programul
