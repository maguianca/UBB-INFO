     1                                  
     2                                  bits 32
     3                                  global start        
     4                                  ;ex11:Se da un nume de fisier (definit in segmentul de date). Sa se creeze un fisier cu numele dat, apoi sa se citeasca de la tastatura ;cuvinte si sa se scrie in fisier cuvintele citite pana cand se citeste de la t
     5                                  
     6                                  
     7                                  ; declararea functiilor externe folosite de program
     8                                  extern exit, fopen, fprintf, fclose, scanf
     9                                  import exit msvcrt.dll  
    10                                  import fopen msvcrt.dll  
    11                                  import fprintf msvcrt.dll
    12                                  import fclose msvcrt.dll
    13                                  import scanf msvcrt.dll
    14                                                            
    15                                  segment  data use32 class=date  
    16 00000000 257300                  	format  db "%s", 0  
    17 00000003 7700                        mod_acces db "w", 0
    18 00000005 6965736972652E7478-         nume_fisier db "iesire.txt", 0
    18 0000000E 7400               
    19 00000010 00000000                    descriptor_fisier dd 0
    20 00000014 <res 00000064>              text resb 100
    21 00000078 256300                      char db "%c",0
    22                                      
    23                                  segment  code use32 class=code
    24                                      start:
    25                                          ; Deschiderea fisierului
    26 00000000 68[03000000]                    push dword mod_acces
    27 00000005 68[05000000]                    push dword nume_fisier
    28 0000000A FF15[00000000]                  call [fopen]
    29 00000010 83C408                          add esp, 4 * 2
    30 00000013 83F800                          cmp eax, 0
    31 00000016 7461                            je final ; eroare la deschiderea fisierului
    32 00000018 A3[10000000]                    mov [descriptor_fisier], eax
    33                                  
    34                                       citire:
    35                                          ; vom apela scanf(format, n) => se va citi un numar in variabila n
    36                                          ; punem parametrii pe stiva de la dreapta la stanga
    37 0000001D 68[14000000]                    push  dword text       ; ! adresa lui n, nu valoarea
    38 00000022 68[00000000]                    push  dword format
    39 00000027 FF15[00000000]                  call  [scanf]       ; apelam functia scanf pentru citire
    40 0000002D 83C408                          add  esp, 4 * 2     ; eliberam parametrii de pe stiva; 4 = dimensiunea unui dword; 2 = nr de parametri
    41                                          
    42                                          ;convertim n la dword pentru a pune valoarea pe stiva 
    43 00000030 B800000000                      mov  eax,0
    44 00000035 A0[14000000]                    mov  al,byte[text]
    45 0000003A 3C24                            cmp al, '$'
    46 0000003C 742C                            je finalizare_scriere ; Daca am intalnit '$', iesim din bucla
    47                                          
    48                                          ;afisam mesajul si valoarea lui n
    49 0000003E 68[14000000]                    push dword text
    50 00000043 FF35[10000000]                  push dword [descriptor_fisier]
    51 00000049 FF15[00000000]                  call  [fprintf]
    52 0000004F 83C408                          add  esp,4*2
    53                                          
    54 00000052 6A20                            push dword ' '  ; ASCII pentru spa»õiu
    55 00000054 68[78000000]                    push dword char
    56 00000059 FF35[10000000]                  push dword [descriptor_fisier]
    57 0000005F FF15[00000000]                  call [fprintf]
    58 00000065 83C40C                          add esp, 4 * 3
    59                                          
    60                                          
    61 00000068 E2B3                          loop citire
    62                                          
    63                                        finalizare_scriere:
    64                                          ; Inchidem fisierul
    65 0000006A FF35[10000000]                  push dword [descriptor_fisier]
    66 00000070 FF15[00000000]                  call [fclose]
    67 00000076 83C404                          add esp, 4
    68                                          ; exit(0)
    69                                         final:
    70 00000079 6A00                            push  dword 0     ; punem pe stiva parametrul pentru exit
    71 0000007B FF15[00000000]                  call  [exit]       ; apelam exit pentru a incheia programul
