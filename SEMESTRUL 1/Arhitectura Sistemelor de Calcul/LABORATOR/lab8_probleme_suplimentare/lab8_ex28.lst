     1                                  
     2                                  bits 32
     3                                  global start        
     4                                  ;ex 26:Se da un nume de fisier (definit in segmentul de date). Sa se creeze un fisier cu numele dat, apoi sa se citeasca de la tastatura ;cuvinte pana cand se citeste de la tastatura caracterul '$'. Sa se scrie in f
     5                                  ; declararea functiilor externe folosite de program
     6                                  extern exit, fopen, fprintf, fclose, scanf
     7                                  import exit msvcrt.dll  
     8                                  import fopen msvcrt.dll  
     9                                  import fprintf msvcrt.dll
    10                                  import fclose msvcrt.dll
    11                                  import scanf msvcrt.dll
    12                                                            
    13                                  segment  data use32 class=data
    14 00000000 00                      	n db 0       ; in aceasta variabila se va stoca valoarea citita de la tastatura
    15 00000001 257300                  	format  db "%s", 0  ; %d <=> un numar decimal (baza 10)
    16 00000004 7700                        mod_acces db "w", 0
    17 00000006 6F75747075742E7478-         nume_fisier db "output.txt", 0
    17 0000000F 7400               
    18 00000011 00000000                    descriptor_fisier dd 0
    19 00000015 <res 00000064>              text resb 100
    20 00000079 256300                      char db "%c",0
    21 0000007C 00<rept>                    cuvant times 50 db 0
    22 000000AE 25732000                    format_afisare db "%s ",0
    23                                      
    24                                  segment  code use32 class=code
    25                                      reset:
    26 00000000 60                              pushad 
    27 00000001 B932000000                      mov ecx,50
    28 00000006 BF[7C000000]                    mov edi,cuvant
    29 0000000B B000                            mov al,0
    30 0000000D F3AA                            rep stosb
    31 0000000F 61                              popad 
    32 00000010 C3                              ret
    33                                      start:
    34                                          ; Deschiderea fisierului
    35 00000011 68[04000000]                    push dword mod_acces
    36 00000016 68[06000000]                    push dword nume_fisier
    37 0000001B FF15[00000000]                  call [fopen]
    38 00000021 83C408                          add esp, 4 * 2
    39 00000024 83F800                          cmp eax, 0
    40 00000027 744C                            je final ; eroare la deschiderea fisierului
    41 00000029 A3[11000000]                    mov [descriptor_fisier], eax
    42                                      urmator:
    43 0000002E E8CDFFFFFF                      call reset
    44 00000033 BF[7C000000]                    mov edi,cuvant
    45 00000038 BB00000000                      mov ebx,0
    46                                       citire:
    47 0000003D 68[15000000]                    push  dword text       
    48 00000042 68[79000000]                    push  dword char
    49 00000047 FF15[00000000]                  call  [scanf]       
    50 0000004D 83C408                          add  esp, 4 * 2     
    51                                          
    52 00000050 B800000000                      mov  eax,0
    53 00000055 A0[15000000]                    mov  al,byte[text]
    54 0000005A 3C24                            cmp al, '$'
    55 0000005C 7408                            je finalizare_scriere ; Daca am intalnit '$', iesim din bucla
    56 0000005E 3C20                            cmp al,' '
    57 00000060 741B                            je numara
    58                                          
    59 00000062 AA                              stosb 
    60 00000063 43                              inc ebx
    61                                          
    62                                          
    63 00000064 EBD7                          jmp citire
    64                                          
    65                                        finalizare_scriere:
    66                                          ; Inchidem fisierul
    67 00000066 FF35[11000000]                  push dword [descriptor_fisier]
    68 0000006C FF15[00000000]                  call [fclose]
    69 00000072 83C404                          add esp, 4
    70                                          ; exit(0)
    71                                         final:
    72 00000075 6A00                            push  dword 0     ; punem pe stiva parametrul pentru exit
    73 00000077 FF15[00000000]                  call  [exit]       ; apelam exit pentru a incheia programul
    74                                         
    75                                      numara:
    76 0000007D 60                             pushad
    77 0000007E BE[7C000000]                   mov esi,cuvant
    78 00000083 89D9                           mov ecx,ebx
    79 00000085 B200                           mov dl,0
    80                                      loop_1:
    81 00000087 AC                             lodsb 
    82 00000088 3C7A                           cmp al,'z'
    83 0000008A 7706                           ja peste
    84 0000008C 3C61                           cmp al,'a'
    85 0000008E 7202                           jb peste
    86 00000090 FEC2                           inc dl
    87                                         peste:
    88 00000092 E2F3                           loop loop_1
    89 00000094 80FA00                         cmp dl,0
    90 00000097 7419                           jz sare
    91                                         
    92 00000099 68[7C000000]                    push dword cuvant
    93 0000009E 68[AE000000]                    push dword format_afisare
    94 000000A3 FF35[11000000]                  push dword [descriptor_fisier]
    95 000000A9 FF15[00000000]                  call  [fprintf]
    96 000000AF 83C40C                          add  esp,4*3
    97                                          
    98                                          sare:
    99 000000B2 61                              popad
   100 000000B3 E976FFFFFF                      jmp urmator
